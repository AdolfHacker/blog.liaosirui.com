## 计算机的内部工作原理

三个基本部件需要关注：CPU、寄存器及内存

- 代码（汇编指令）以二进制的形式保存在内存中
- CPU 从中一条条地加载指令执行
- 程序运行的状态保存在寄存器中

### 内存

内存用于存储数据，这里的数据可以是代码，也可以是其它的数据

现代操作系统在操作内存时，并不是直接处理”物理内存“，而是操作”虚拟内存“。虚拟内存可以理解为一种映射，它的作用是屏蔽了物理的细节

例如 32 位的机器中，可以使用的内存地址为 `2^32 = 4G`，而电脑上的实际内存可能只有 `256 M`

操作系统将使用的虚拟地址映射到了到实际的内存上

进程的内存会被分成几个段：

1. 代码段（text）用于存放代码（指令）
2. 数据段（data）用于存放初始化了的数据，如`int i = 10;`，就需要存放到数据段中
3. 未初始化数据段（bss）用于存放未初始化的数据，如 `int i[1000];`，因为不关心其中的真正数值，所以单独存放可以节省空间，减少程序的体积
4. 栈（stack）用于处理函数调用相关的数据，如调用帧（calling frame）或是函数的局部变量等
5. 堆（heap）用于为程序动态分配内存

在内存中的位置类似于下图：

```plain
+------------------+
|    stack   |     |      high address
|    ...     v     |
|                  |
|                  |
|                  |
|                  |
|    ...     ^     |
|    heap    |     |
+------------------+
| bss  segment     |
+------------------+
| data segment     |
+------------------+
| text segment     |      low address
+------------------+

```

在本设计中：

- 虚拟机并不打算模拟完整的计算机，因此简单起见，只关心三个内容：代码段、数据段以及栈

- 其中的数据段只用来存放字符串，因为编译器并不支持初始化变量，因此也不需要未初始化数据段
