
## 镜像组出现 Need-resync

出现如下状态（这里以 meta 为例）

```bash
> beegfs-ctl --listtargets --nodetype=meta --state

TargetID     Reachability  Consistency   NodeID
========     ============  ===========   ======
       2           Online Needs-resync        2
       3           Online Needs-resync        3
```

确定主从

```bash
beegfs-ctl --listmirrorgroups --nodetype=meta
```

重新同步

```bash
beegfs-ctl --setstate --nodetype=meta/storage --nodeid=<nodeid> --state=good --force

# 上一步设置 Good 后，就开始 resync 了
beegfs-ctl --startresync --nodeid=<nodeid> --nodetype=meta
beegfs-ctl --startresync --nodetype=storage --targetid=X --timestamp=0 --restart 
```

## 内核 5.14 无法使用 beegfs 7.3.2

修改：

```bash
sed -i 's|#include <stdarg.h>|//#include <linux/stdarg.h>|g' /opt/beegfs/src/client/client_module_7/source/common/Common.h

sed -i 's/PDE_DATA(const struct inode *)/pde_data(const struct inode *inode)/g' /opt/beegfs/src/client/client_module_7/build/KernelFeatureDetection.mk

sed -i 's/PDE_DATA(/pde_data(/g' /opt/beegfs/src/client/client_module_7/source/filesystem/ProcFs.c
```

其他修改处：

```bash
diff --git a/client_module/build/KernelFeatureDetection.mk b/client_module/build/KernelFeatureDetection.mk
index 8e937d1..9d08886 100644
--- a/client_module/build/KernelFeatureDetection.mk
+++ b/client_module/build/KernelFeatureDetection.mk
@@ -102,7 +102,8 @@ $(call define_if_matches, KERNEL_HAS_D_MATERIALISE_UNIQUE, \
 # Find out whether the kernel has a PDE_DATA method.
 #
 # Note: This method was added in vanilla linux-3.10
-$(call define_if_matches, KERNEL_HAS_PDE_DATA, -F "PDE_DATA(const struct inode *)", proc_fs.h)
+#$(call define_if_matches, KERNEL_HAS_PDE_DATA, -F "PDE_DATA(const struct inode *)", proc_fs.h)
+$(call define_if_matches, KERNEL_HAS_PDE_DATA, -F "pde_data(const struct inode *inode)", proc_fs.h)
 
 # Find out whether the kernel has i_uid_read
 #
diff --git a/client_module/source/Makefile b/client_module/source/Makefile
index 375f647..d8f612c 100644
--- a/client_module/source/Makefile
+++ b/client_module/source/Makefile
@@ -184,6 +184,8 @@ SOURCES := \
 
 ${TARGET}-y    := $(patsubst %.c,%.o,$(SOURCES))
 
+NOSTDINC_FLAGS+=-isystem $(shell $(CC) -print-file-name=include)
+
 ifneq ($(OFED_INCLUDE_PATH),)
 
 # RHEL/CentOS 8 + MLNX 4.7 requires extra flags (bug?)
diff --git a/client_module/source/filesystem/ProcFs.c b/client_module/source/filesystem/ProcFs.c
index 70e2536..88d6eee 100644
--- a/client_module/source/filesystem/ProcFs.c
+++ b/client_module/source/filesystem/ProcFs.c
@@ -689,7 +689,7 @@ void* __ProcFs_getProcDirEntryDataField(const struct inode* procInode)
 
    #ifdef KERNEL_HAS_PDE_DATA
 
-      return PDE_DATA(procInode);
+      return pde_data(procInode);
 
    #else
```

